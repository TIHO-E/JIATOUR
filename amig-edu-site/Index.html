<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AMIG - Student Credential & Learning Platform</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/intl@1.2.5/Intl.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    body {
      font-family: "Arial Rounded MT", sans-serif;
      background-color: #f0f8ff;
    }
    header {
      background-color: #6dc6d1;
      color: white;
      padding: 20px 0;
      text-align: center;
      position: relative;
    }
    .card {
      margin-top: 20px;
    }
    .lang-toggle {
      position: absolute;
      right: 20px;
      top: 20px;
    }
    .currency-date {
      margin-top: 10px;
      font-style: italic;
    }
  </style>
</head>
<body>

  <header>
    <div class="lang-toggle">
      <button class="btn btn-sm btn-light" onclick="setLanguage('en')">English</button>
      <button class="btn btn-sm btn-light" onclick="setLanguage('zh')">中文</button>
    </div>
    <h1 id="header-title"></h1>
    <p id="header-description"></p>
    <div class="currency-date" id="localTime"></div>
  </header>

  <div class="container">
    <div class="card">
      <div class="card-header bg-primary text-white" id="credential-title"></div>
      <div class="card-body">
        <p id="credential-description"></p>
        <ul id="credential-list"></ul>
        <button class="btn btn-outline-success" onclick="connectWallet()" id="connect-button"></button>
        <p id="certStatus" class="text-muted mt-2"></p>
      </div>
    </div>

    <div class="card">
      <div class="card-header bg-secondary text-white" id="nft-title"></div>
      <div class="card-body">
        <p id="nft-description"></p>
        <ul id="nft-list"></ul>
        <button class="btn btn-outline-warning" id="nft-button"></button>
      </div>
    </div>

    <div class="card">
      <div class="card-header bg-info text-white" id="upload-title"></div>
      <div class="card-body">
        <p id="upload-description"></p>
        <button class="btn btn-outline-primary" id="upload-button"></button>
      </div>
    </div>

    <div class="card">
      <div class="card-header bg-warning text-dark" id="leaderboard-title"></div>
      <div class="card-body">
        <p id="leaderboard-description"></p>
        <ol id="leaderboard-list"></ol>
      </div>
    </div>
  </div>

  <script>
    let translations = {};
    let currentLang = 'en';

    function setLanguage(lang) {
      currentLang = lang;
      localStorage.setItem('preferredLanguage', lang);
      applyTranslations();
      renderLocalizedInfo(lang);
    }

    function applyTranslations() {
      if (!translations[currentLang]) return;
      const t = translations[currentLang];
      const set = (id, value) => { const el = document.getElementById(id); if (el) el.innerText = value; };

      set("header-title", t["header-title"]);
      set("header-description", t["header-description"]);
      set("credential-title", t["credential-title"]);
      set("credential-description", t["credential-description"]);
      set("connect-button", t["connect-button"]);
      set("nft-title", t["nft-title"]);
      set("nft-description", t["nft-description"]);
      set("nft-button", t["nft-button"]);
      set("upload-title", t["upload-title"]);
      set("upload-description", t["upload-description"]);
      set("upload-button", t["upload-button"]);
      set("leaderboard-title", t["leaderboard-title"]);
      set("leaderboard-description", t["leaderboard-description"]);

      const ul = document.getElementById("credential-list");
      ul.innerHTML = "";
      t["credential-items"].forEach(item => {
        const li = document.createElement("li");
        li.innerText = item;
        ul.appendChild(li);
      });

      const nftUl = document.getElementById("nft-list");
      nftUl.innerHTML = "";
      t["nft-items"].forEach(item => {
        const li = document.createElement("li");
        li.innerText = item;
        nftUl.appendChild(li);
      });

      const lb = document.getElementById("leaderboard-list");
      lb.innerHTML = "";
      t["leaderboard-items"].forEach(item => {
        const li = document.createElement("li");
        li.innerText = item;
        lb.appendChild(li);
      });
    }

    function renderLocalizedInfo(lang) {
      const now = new Date();
      const currency = new Intl.NumberFormat(lang === 'zh' ? 'zh-CN' : 'en-US', {
        style: 'currency',
        currency: lang === 'zh' ? 'CNY' : 'USD'
      }).format(1234.56);

      const dateStr = new Intl.DateTimeFormat(lang === 'zh' ? 'zh-CN' : 'en-US', {
        dateStyle: 'full',
        timeStyle: 'short'
      }).format(now);

      document.getElementById('localTime').innerText =
        (lang === 'zh' ? '当前时间与示例金额：' : 'Current time & sample currency: ') + dateStr + ' / ' + currency;
    }

    async function connectWallet() {
      if (typeof window.ethereum !== 'undefined') {
        const web3 = new Web3(window.ethereum);
        try {
          await ethereum.request({ method: 'eth_requestAccounts' });
          const accounts = await web3.eth.getAccounts();
          document.getElementById('certStatus').innerText = `✅ Wallet connected: ${accounts[0]}`;
        } catch (error) {
          document.getElementById('certStatus').innerText = '❌ Wallet connection failed. Please try again.';
        }
      } else {
        alert('Please install MetaMask to use Web3 features.');
      }
    }

    async function loadTranslations() {
      try {
        const [enRes, zhRes] = await Promise.all([
          axios.get("/i18n/en.json"),
          axios.get("/i18n/zh.json")
        ]);
        translations = {
          en: enRes.data,
          zh: zhRes.data
        };
        const savedLang = localStorage.getItem('preferredLanguage');
        const userLang = savedLang || (navigator.language.startsWith('zh') ? 'zh' : 'en');
        setLanguage(userLang);
      } catch (err) {
        console.error("Translation loading error:", err);
      }
    }

    loadTranslations();
  </script>

</body>
</html>
